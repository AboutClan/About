<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>인증 완료 처리 중</title>
  </head>
  <body>
    <p>인증이 완료되었습니다. 잠시만 기다려주세요...</p>
    <script>
      window.onload = function () {
        const urlParams = new URLSearchParams(window.location.search);
        const web_transaction_id = urlParams.get("web_transaction_id");

        console.log("NICE에서 받은 ID:", web_transaction_id);
        console.log("부모 창(opener) 연결 상태:", window.opener ? "성공" : "실패");

        if (web_transaction_id) {
          if (window.opener && !window.opener.closed) {
            // 부모 창으로 데이터 전송
            window.opener.postMessage({ web_transaction_id: web_transaction_id }, "*");

            // 메시지 전송 후 창 닫기 (지연을 주어 확실히 전송)
            setTimeout(() => {
              window.close();
            }, 300);
          } else {
            alert("부모 창을 찾을 수 없습니다. 인증 창을 닫고 다시 시도해 주세요.");
            window.close();
          }
        } else {
          alert("잘못된 접근입니다.");
          window.close();
        }
      };
    </script>
  </body>
</html>
